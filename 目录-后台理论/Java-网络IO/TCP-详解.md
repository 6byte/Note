## TCP-详解

### TCP connection

```
1.客户端与服务器发送、返回数据需要创建TCP connection

2.TCP是无连接状态的，只存在请求和响应，请求和响应都是数据包，这个连接可以一直保持

3.一个TCP连接上是可以发送多个http请求的，不同的版本这个模式不一样。

4.HTTP/1.1的连接一直保持，一个请求传输完之后，另一个请求可以接着传输，减少三次握手”的消耗
```

### TCP 报文

```
1、端口号：用来标识同一台计算机的不同的应用进程。

	1）源端口：源端口和IP地址的作用是标识报文的返回地址

	2）目的端口：端口指明接收方计算机上的应用程序接口

2、字节序号和确认号<关键>：
	1）字节序号是一段数据的第一个字节的序号。一个报文段的序号为300，则下一个是400。
	2）ACK确认号，指明将要收到的字节序号，表示该序号之前的所有数据都已收到。ACK标志为1时表示有效。比如建立连接时，SYN报文的ACK标志位为0。

3、数据偏移／首部长度
	1）首部可能有可选内容，因此TCP报头长度不确定！
	2）首部最少长度=20字节，最大长度=60字节

4、保留：为将来定义新的用途保留，现在一般置0。

5、控制位：URG  ACK  PSH  RST  SYN  FIN，共6个，每一个标志位表示一个控制功能。

1）URG：为1时表示紧急指针有效，为0则忽略紧急指针。

2）ACK：确认序号=1有效；为0忽略。

3）PSH：值=1生效，指示接收方尽快处理该报文段

4）RST：重置连接标志，用于重置错误的连接，或拒绝非法的报文段、连接请求。

5）SYN：用于建立连接。

6）FIN：释放连接

6、窗口：通过指定缓存大小，控制流量

7、校验和：奇偶校验，校验 TCP 头部和 TCP 数据！发送端 进行计算和存储，接收端验证。

8、紧急指针：URG = 1生效。紧急指针是一个正的偏移量，和顺序号字段中的值相加表示紧急数据最后一个字节的序号。 TCP 的紧急方式是发送端向另一端发送紧急数据的一种方式。

9、选项和填充：表示本端能接受最大报文段的长度。在字段中加入额外的零，保证是32的整数倍。

10、数据部分： TCP 报文段中的数据部分是可选的。一个连接建立终止，双方交换的报文段仅有 TCP 首部。
```





